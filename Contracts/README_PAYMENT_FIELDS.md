# إضافة البيانات المالية للعقود

## الحقول المضافة الجديدة

تم إضافة 5 حقول مالية جديدة لنظام إدارة العقود:

### 1. **العملة (price_currency_contract)**
- نوع الحقل: قائمة منسدلة
- الخيارات: دولار، جنيه
- الغرض: تحديد عملة الدفع للعقد

### 2. **المبلغ المدفوع (paid_contract)**
- نوع الحقل: نص
- الغرض: تسجيل قيمة المبلغ المدفوع

### 3. **وقت الدفع (payment_time)**
- نوع الحقل: قائمة منسدلة
- الخيارات: مقدم، مؤخر
- الغرض: تحديد توقيت الدفع (قبل أو بعد التنفيذ)

### 4. **الضمانات (guarantees)**
- نوع الحقل: نص
- الغرض: تسجيل تفاصيل الضمانات المطلوبة

### 5. **تاريخ الدفع (payment_date)**
- نوع الحقل: تاريخ
- الغرض: تحديد تاريخ الدفع المتوقع أو الفعلي

---

## التحديثات المطلوبة في قاعدة البيانات

### خطوات تطبيق التحديث:

1. **افتح phpMyAdmin**
2. **اختر قاعدة البيانات:** `equipation_manage`
3. **انقر على تبويب SQL**
4. **انسخ والصق الكود التالي:**

```sql
ALTER TABLE `contracts` 
ADD COLUMN `price_currency_contract` VARCHAR(20) DEFAULT NULL COMMENT 'عملة العقد' AFTER `witness_two`,
ADD COLUMN `paid_contract` VARCHAR(100) DEFAULT NULL COMMENT 'المبلغ المدفوع' AFTER `price_currency_contract`,
ADD COLUMN `payment_time` VARCHAR(50) DEFAULT NULL COMMENT 'وقت الدفع (مقدم/مؤخر)' AFTER `paid_contract`,
ADD COLUMN `guarantees` TEXT DEFAULT NULL COMMENT 'الضمانات' AFTER `payment_time`,
ADD COLUMN `payment_date` DATE DEFAULT NULL COMMENT 'تاريخ الدفع' AFTER `guarantees`;
```

5. **انقر على "تنفيذ" (Go)**

### أو استخدم الملف الجاهز:
يمكنك تنفيذ الملف: `database/add_payment_fields.sql`

---

## الميزات المضافة

### في صفحة إضافة/تعديل العقد:
✅ 5 حقول جديدة في النموذج (موجودة بالفعل في الواجهة)
✅ معالجة البيانات عند الإضافة (INSERT)
✅ معالجة البيانات عند التعديل (UPDATE)

### في صفحة قائمة العقود:
✅ 5 أعمدة جديدة في الجدول لعرض البيانات المالية
✅ البيانات المالية تظهر ضمن مجموعة "المعلومات الأساسية" (group-basic)
✅ دعم التعديل - البيانات تُحمل تلقائياً عند الضغط على زر التعديل

---

## الاستخدام

### إضافة عقد جديد:
1. انقر على "عقد جديد"
2. املأ البيانات الأساسية
3. في قسم "البيانات الأساسية للعميل والعقد"، ستجد:
   - حقل العملة
   - حقل المبلغ المدفوع
   - حقل وقت الدفع
   - حقل الضمانات
   - حقل تاريخ الدفع
4. احفظ البيانات

### تعديل عقد موجود:
1. انقر على زر التعديل ✏️ للعقد المطلوب
2. ستُحمل جميع البيانات تلقائياً بما فيها البيانات المالية
3. عدّل البيانات المطلوبة
4. احفظ التعديلات

### عرض البيانات:
- البيانات المالية تظهر في أعمدة منفصلة في جدول العقود
- يمكن إخفاء/إظهار الأعمدة باستخدام أزرار المجموعات في أعلى الجدول

---

## ملاحظات مهمة

⚠️ **يجب تنفيذ استعلام SQL أولاً** قبل استخدام النظام المحدث
⚠️ الحقول الجديدة اختيارية (nullable) - لا تؤثر على العقود الموجودة
✅ جميع التحديثات متوافقة مع الأكواد الموجودة
✅ لا تحتاج لتعديلات إضافية

---

## في حالة وجود مشاكل

### إذا لم تظهر الأعمدة في الجدول:
- تأكد من تنفيذ استعلام SQL
- حدث الصفحة (Ctrl + F5)

### إذا لم تُحفظ البيانات:
- تحقق من وجود الحقول في قاعدة البيانات
- تأكد من أن خاصية `name` في HTML مطابقة للأسماء المتوقعة

---

## تاريخ التحديث
**التاريخ:** 29 يناير 2026  
**النسخة:** 2.0  
**المطور:** تم بواسطة GitHub Copilot
